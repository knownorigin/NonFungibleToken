<html>

<head>
    <title>KnownOrigin Explorer</title>
    <style>
        #app {
            font-family: 'Avenir', Helvetica, Arial, sans-serif;
            margin: 60px auto;
            max-width: 600px;
            padding: 0em 1em;
        }

        ul {
            list-style-type: none;
            padding: 0em 1em;
        }

        li {
            display: block;
            margin: 10px;
        }

        h1 {
            text-align: center;
            font-size: 2em;
        }

        p {
            font-size: 0.8em;
        }

        .mute {
            color: gray;
            font-size: 0.8em;
            text-align: center;
        }

        .metadata {
            max-width: 300px;
        }
    </style>
</head>

<body>

<div id="app">
    <h1>KnownOrigin Explorer</h1>
    <div id="overview"></div>
    <div id="total_items"></div>
    <div id="entity_list">
        <ul></ul>
    </div>
    <p class="mute">Open developer tools and view console for logging</p>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ethjs@0.3.0/dist/ethjs.min.js"></script>

<script>
    var eth = new window.Eth(new window.Eth.HttpProvider('https://ropsten.infura.io'));

    eth.getBlockByNumber(45300, true, function (err, block) {
        console.log(err);
        console.log(block);
    });

    var address = '0xc353f05599f832062964aa4f4f2f2398c7986b49';

    var abi = [{"constant": true, "inputs": [], "name": "name", "outputs": [{"name": "_name", "type": "string"}], "payable": false, "stateMutability": "view", "type": "function"}, {
        "constant": true,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "getApproved",
        "outputs": [{"name": "_approved", "type": "address"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{"name": "_to", "type": "address"}, {"name": "_tokenId", "type": "uint256"}],
        "name": "approve",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [],
        "name": "implementsERC721",
        "outputs": [{"name": "_implementsERC721", "type": "bool"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [],
        "name": "totalSupply",
        "outputs": [{"name": "_totalSupply", "type": "uint256"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{"name": "_from", "type": "address"}, {"name": "_to", "type": "address"}, {"name": "_tokenId", "type": "uint256"}],
        "name": "transferFrom",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "isPurchased",
        "outputs": [{"name": "_purchased", "type": "uint8"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "_owner", "type": "address"}, {"name": "_index", "type": "uint256"}],
        "name": "tokenOfOwnerByIndex",
        "outputs": [{"name": "_tokenId", "type": "uint256"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{"name": "_metadata", "type": "string"}, {"name": "_edition", "type": "string"}, {"name": "_totalEdition", "type": "uint8"}, {"name": "_priceInWei", "type": "uint256"}],
        "name": "mintEdition",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "editionOf",
        "outputs": [{"name": "_edition", "type": "string"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "ownerOf",
        "outputs": [{"name": "_owner", "type": "address"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "tokenMetadata",
        "outputs": [{"name": "_infoUrl", "type": "string"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "_owner", "type": "address"}],
        "name": "balanceOf",
        "outputs": [{"name": "_balance", "type": "uint256"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{"name": "_tokenId", "type": "uint256"}, {"name": "_priceInWei", "type": "uint256"}],
        "name": "setPriceInWei",
        "outputs": [{"name": "", "type": "bool"}],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "fiatPurchase",
        "outputs": [{"name": "", "type": "bool"}],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {"constant": true, "inputs": [], "name": "symbol", "outputs": [{"name": "_symbol", "type": "string"}], "payable": false, "stateMutability": "view", "type": "function"}, {
        "constant": true,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "priceOfInWei",
        "outputs": [{"name": "_priceInWei", "type": "uint256"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{"name": "_to", "type": "address"}, {"name": "_tokenId", "type": "uint256"}],
        "name": "transfer",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {"constant": true, "inputs": [], "name": "numTokensTotal", "outputs": [{"name": "", "type": "uint256"}], "payable": false, "stateMutability": "view", "type": "function"}, {
        "constant": false,
        "inputs": [{"name": "_metadata", "type": "string"}, {"name": "_edition", "type": "string"}, {"name": "_priceInWei", "type": "uint256"}],
        "name": "mint",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "_owner", "type": "address"}],
        "name": "getOwnerTokens",
        "outputs": [{"name": "_tokenIds", "type": "uint256[]"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {"constant": true, "inputs": [], "name": "curator", "outputs": [{"name": "", "type": "address"}], "payable": false, "stateMutability": "view", "type": "function"}, {
        "constant": false,
        "inputs": [{"name": "_tokenId", "type": "uint256"}],
        "name": "purchase",
        "outputs": [{"name": "", "type": "bool"}],
        "payable": true,
        "stateMutability": "payable",
        "type": "function"
    }, {"inputs": [], "payable": false, "stateMutability": "nonpayable", "type": "constructor"}, {
        "anonymous": false,
        "inputs": [{"indexed": true, "name": "_tokenId", "type": "uint256"}, {"indexed": true, "name": "_buyer", "type": "address"}],
        "name": "Purchased",
        "type": "event"
    }, {"anonymous": false, "inputs": [{"indexed": true, "name": "_tokenId", "type": "uint256"}], "name": "PurchasedWithFiat", "type": "event"}, {
        "anonymous": false,
        "inputs": [{"indexed": true, "name": "_to", "type": "address"}, {"indexed": true, "name": "_tokenId", "type": "uint256"}],
        "name": "Mint",
        "type": "event"
    }, {
        "anonymous": false,
        "inputs": [{"indexed": true, "name": "_from", "type": "address"}, {"indexed": true, "name": "_to", "type": "address"}, {"indexed": false, "name": "_tokenId", "type": "uint256"}],
        "name": "Transfer",
        "type": "event"
    }, {
        "anonymous": false,
        "inputs": [{"indexed": true, "name": "_owner", "type": "address"}, {"indexed": true, "name": "_approved", "type": "address"}, {"indexed": false, "name": "_tokenId", "type": "uint256"}],
        "name": "Approval",
        "type": "event"
    }];

    console.log('Instantiating contract at ' + address);
    console.log('Contract ABI ' + abi);

    var knownOriginNft = eth.contract(abi).at(address);
    console.log(knownOriginNft);

    ['name', 'curator', 'totalSupply', 'symbol'].forEach(function (readOnlyFunc) {
        knownOriginNft[readOnlyFunc]().then(function (result) {
            console.log(readOnlyFunc + ' >> ' + result[0].toString());
            $('#overview').append('<p>' + readOnlyFunc + ': <strong>' + result[0].toString() + '</strong></p>');
        });
    });

    knownOriginNft.totalSupply().then(function (result) {
        var totalSupply = result[0].toString();
        var totalSupplyArray = new Array(parseInt(totalSupply));

        for (var i = 0; i < totalSupplyArray.length; i++) {
            knownOriginNft.tokenMetadata(i).then(function (result) {
                console.log(i + ': ' + result[0].toString());
                $('#entity_list ul').append('<li><img class="metadata" src="https://ipfs.infura.io/ipfs/' + result[0].toString() + '"/></li>');
            });
        }
    });

</script>
</body>

</html>